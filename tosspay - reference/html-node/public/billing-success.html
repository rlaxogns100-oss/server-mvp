<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="https://static.toss.im/icons/png/4x/icon-toss-logo.png" />
    <link rel="stylesheet" type="text/css" href="style.css" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>자동결제 카드 등록 완료</title>
  </head>

  <body>
    <div class="box_section" style="width: 600px">
      <img width="100px" src="https://static.toss.im/illusts/check-blue-spot-ending-frame.png" />
      <h2>자동결제 카드가 등록되었어요</h2>

      <p class="typography--p" style="margin-top: 40px">
        이제 이 카드로 자동결제를 요청할 수 있습니다.
      </p>
      <div class="p-grid" style="margin-top: 30px">
        <button class="button p-grid-col5" onclick="location.href='/billing';">다른 카드 등록하기</button>
      </div>
    </div>

    <script>
      const urlParams = new URLSearchParams(window.location.search);

      const authKey = urlParams.get("authKey");
      const customerKey = urlParams.get("customerKey");

      async function issueBillingKey() {
        // 카드 등록 완료 후, authKey와 customerKey로 빌링키 발급 API를 호출합니다.
        const response = await fetch("/billing/issue", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            authKey: authKey,
            customerKey: customerKey,
          }),
        });

        const json = await response.json();

        // 운영 환경에서는 이 응답에서 billingKey와 customerKey를 읽어
        // 서버 DB에 저장하고, 화면에는 노출하지 마세요.
        console.log("BillingKey 발급 응답", json);
      }

      // 페이지 로드 시 자동으로 빌링키를 발급합니다.
      if (authKey && customerKey) {
        issueBillingKey();
      }
    </script>
  </body>
</html>


