<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="https://static.toss.im/icons/png/4x/icon-toss-logo.png" />
    <link rel="stylesheet" type="text/css" href="billing-style.css" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>토스 자동결제(빌링) 카드 등록</title>
    <!-- 토스페이먼츠 SDK 추가 -->
    <script src="https://js.tosspayments.com/v2/standard"></script>
  </head>

  <body>
    <div class="wrapper">
      <div class="box_section" style="padding: 40px 30px 50px 30px; margin-top: 30px; margin-bottom: 50px">
        <h2 style="margin-bottom: 20px">자동결제 카드 등록</h2>
        <p style="margin-bottom: 20px">아래 버튼을 눌러 자동결제에 사용할 카드를 등록하세요.</p>
        <div class="result wrapper">
          <button class="button" id="billing-button" style="margin-top: 30px">
            카드 등록하기
          </button>
        </div>
      </div>
    </div>

    <script>
      main();

      async function main() {
        const button = document.getElementById("billing-button");

        // ------ 자동결제(빌링) 결제창 초기화 ------
        // @docs https://docs.tosspayments.com/guides/v2/billing/integration#1-%EA%B5%AC%EB%A7%A4%EC%9E%90-%EC%B9%B4%EB%93%9C-%EB%93%B1%EB%A1%9D%ED%95%98%EA%B8%B0
        const clientKey = "test_ck_vZnjEJeQVxePJdEMyexZrPmOoBN0"; // API 개별 연동 키의 클라이언트 키로 교체
        const customerKey = generateRandomString();
        const tossPayments = TossPayments(clientKey);
        const payment = tossPayments.payment({ customerKey });

        // '카드 등록하기' 버튼 클릭 시 자동결제(빌링) 카드 등록창 호출
        button.addEventListener("click", async function () {
          try {
            await payment.requestBillingAuth({
              method: "CARD",
              successUrl: window.location.origin + "/billing-success.html",
              failUrl: window.location.origin + "/billing-fail.html",
            });
          } catch (error) {
            console.error(error);
          }
        });
      }

      function generateRandomString() {
        return window.btoa(Math.random()).slice(0, 20);
      }
    </script>
  </body>
</html>


